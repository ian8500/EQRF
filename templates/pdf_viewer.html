{% extends "base.html" %}
{% block title %}View PDF{% endblock %}
{% block content %}
<style>
    #pdf-toolbar {
        background: #000;
        color: white;
        padding: 10px;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    #pdf-canvas {
        display: block;
        margin: 0 auto;
        width: 100%;
        height: auto;
    }
</style>

<div id="pdf-toolbar">
    <button onclick="zoomIn()">âž• Zoom In</button>
    <button onclick="zoomOut()">âž– Zoom Out</button>
    <button onclick="rotate()">ðŸ”„ Rotate</button>
</div>

<canvas id="pdf-canvas"></canvas>

<script src="{{ url_for('static', filename='pdfjs/pdf.js') }}"></script>
<script>
    let url = "{{ url_for('static', filename='pdfs/' + filename) }}";
    let pdfDoc = null,
        pageNum = 1,
        scale = 1.0,
        rotation = 0;

    const canvas = document.getElementById('pdf-canvas');
    const ctx = canvas.getContext('2d');

    pdfjsLib.GlobalWorkerOptions.workerSrc = "{{ url_for('static', filename='pdfjs/pdf.worker.js') }}";

    function renderPage(num) {
        pdfDoc.getPage(num).then(page => {
            const viewport = page.getViewport({ scale: scale, rotation: rotation });
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            page.render(renderContext);
        });
    }

    function zoomIn() {
        scale += 0.1;
        renderPage(pageNum);
    }

    function zoomOut() {
        scale = Math.max(0.1, scale - 0.1);
        renderPage(pageNum);
    }

    function rotate() {
        rotation = (rotation + 90) % 360;
        renderPage(pageNum);
    }

    pdfjsLib.getDocument(url).promise.then(pdf => {
        pdfDoc = pdf;
        renderPage(pageNum);
    });
</script>
{% endblock %}
